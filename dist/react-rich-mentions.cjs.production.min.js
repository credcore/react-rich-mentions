"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t=require("react"),n=(e=t)&&"object"==typeof e&&"default"in e?e.default:e;function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var i=function(){},o={getTransformedValue:function(){return""},insertFragment:i,setValue:i,activeSearch:"",inputElement:null,setInputElement:i,selectItem:i,setActiveItemIndex:i,opened:null,index:0,loading:!1,results:[],closeAutocomplete:i,openAutocomplete:i,onBeforeChanges:i,onKeyDown:i,onChanges:i,fixed:!0,setPositionFixed:i},a=t.createContext(o);!function(e,t){void 0===t&&(t={});var n=t.insertAt;if("undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}(".RichMentions-module_xinput__OjGR7{\n    outline: 0;\n}\n.RichMentions-module_xinput__OjGR7.RichMentions-module_xempty__yCKLD:not(:focus):before{\n    content:attr(data-ph);\n    color:grey;\n}\n");var u=["defaultValue","singleLine","placeholder","className","onEnter"];function c(e){return e.nodeType===Node.TEXT_NODE?e.parentElement:e}function l(e){var t=c(e);return t&&t.hasAttribute("data-rich-mentions")?t:null}function s(e,t){var n=document.getSelection(),r=document.createRange();r.setStart(e,t),r.collapse(!0),n&&(n.removeAllRanges(),n.addRange(r))}function f(e,t,n){void 0===n&&(n="after");var r=document.createTextNode(t.replace(/\s/g," ")),i=e.parentElement;i&&(i.insertBefore(r,"after"===n?e.nextSibling:e),s(r,t.length))}function d(e,t){for(var n=!1,r=null,i=0;i<e.rangeCount;++i){var o=e.getRangeAt(i);o.startContainer===o.endContainer&&o.startOffset===o.endOffset||(n=!0,r=o,o.deleteContents())}if(null!=t&&t.data&&r){var a=document.createTextNode(t.data);r.insertNode(a),s(a,1),t.preventDefault()}return n}function m(e,t,n){var r=t.replace(n.match,n.matchDisplay).replace(/\s/g," ");if(e.textContent=r,e.setAttribute("data-rich-mentions",t),e.setAttribute("spellcheck","false"),n.customizeFragment&&n.customizeFragment(e,!0),e.setAttribute("data-integrity",e.innerHTML),e.parentElement){var i=document.createTextNode(" ");e.parentElement.insertBefore(i,e.nextSibling),s(i,1)}}function h(e,t){Array.from(e.children).forEach((function e(n,r){var i=n.parentElement;if(n instanceof HTMLBRElement){if(1!==i.children.length&&r!==i.children.length-1){var o=document.createElement("div");i.insertBefore(o,n),o.appendChild(n)}}else if(n instanceof HTMLDivElement&&!n.attributes.length)Array.from(n.children).forEach(e);else{var a=n.textContent||"";if(!(n instanceof Text||n.hasAttribute("data-rich-mentions")))return i.insertBefore(document.createTextNode(a),n),void i.removeChild(n);n.hasAttribute("data-integrity")?n.getAttribute("data-integrity")!==n.innerHTML&&i.removeChild(n):t.some((function(e){return a.match(e.query)}))||(i.insertBefore(document.createTextNode(a),n.nextSibling),i.removeChild(n))}}))}var p=function(e){return/(\u00A0|\s)/.test(e)},g=function(e,t,n,r){if(t>0)return!p(e.charAt(t-1));if(["DIV","BR"].includes(n.nodeName))return!1;if(n.previousSibling){var i=n.previousSibling.textContent||"";return!!i.length&&!p(i.charAt(i.length-1))}return r},v=function(e,t,n){if(t<e.length)return!p(e.charAt(e.length-1));if(!n.nextSibling)return!0;var r=n.nextSibling.textContent||"";return!r.length||!p(r.charAt(0))},x=function(e,t){var n=c(e);t.contains(n)&&t!==n&&n&&n.hasAttribute("data-integrity")&&t.removeChild(n)};exports.RichMentionsAutocomplete=function(e){var r=e.fixed,i=void 0===r||r,o=e.className,u=e.itemClassName,c=e.selectedItemClassName,l=t.useContext(a),s=l.opened,f=l.index,d=l.results,m=l.setActiveItemIndex,h=l.selectItem,p=l.setPositionFixed,g=function(e){return function(){return h(e)}},v=function(e){return function(){return m(e)}},x={};return t.useEffect((function(){p(i)}),[i,p]),s&&d.length?n.createElement("div",Object.assign({},{},{className:""+o,style:{position:i?"fixed":"absolute",left:s.x+"px",top:s.y+"px"}}),n.createElement("div",{className:"autocomplete-list",style:{bottom:s.bottom?"0px":"auto",right:s.right?"0px":"auto"}},d.map((function(e,t){return n.createElement("button",Object.assign({className:u+" "+(t===f?c:""),type:"button",key:e.ref,onClick:g(e),onMouseOver:v(f)},x),e.name)})))):null},exports.RichMentionsContext=a,exports.RichMentionsInput=function(e){var r=e.defaultValue,i=e.singleLine,o=e.placeholder,c=e.className,l=e.onEnter,s=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t.indexOf(n=o[r])>=0||(i[n]=e[n]);return i}(e,u),f=t.useRef(null),d=t.useContext(a),m=d.setInputElement,h=d.onBeforeChanges,p=d.onKeyDown,g=d.onChanges,v=d.getInitialHTML,x=d.opened,b=d.getTransformedValue,C=t.useState(!b()),E=C[0],y=C[1];null===f.current&&v&&(f.current=v(r||""));var A={};return i&&(A={whiteSpace:"nowrap",overflow:"hidden"}),n.createElement("div",Object.assign({ref:m},s,{className:"RichMentions-module_xinput__OjGR7 "+(E?"RichMentions-module_xempty__yCKLD":"")+" "+c,contentEditable:!0,onBeforeInput:function(e){h(e),s.onBeforeInput&&s.onBeforeInput(e)},onKeyDown:function(e){"Enter"===e.key&&(l&&!x&&setTimeout((function(){l()}),200),i&&e.preventDefault()),p(e),s.onKeyDown&&s.onKeyDown(e)},onInput:function(e){s.onInput&&s.onInput(e),g(e),y(!b())},"data-ph":o,dangerouslySetInnerHTML:{__html:f.current||""},style:A}))},exports.RichMentionsProvider=function(e){var i=e.children,u=e.configs,b=e.getContext,C=e.onUpdate,E=e.getInitialHTML,y=void 0===E?function(e){return function(t){return function(e){var t=document.createElement("div");return t.innerHTML=e,function e(t){Array.from(t.childNodes).forEach((function(t){t instanceof Text&&t.nodeValue?t.nodeValue=t.nodeValue.replace(/( |\t)/g," "):t instanceof HTMLElement&&(e(t),t.hasAttribute("data-rich-mentions")&&!t.hasAttribute("data-integrity")&&t.setAttribute("data-integrity",t.innerHTML))}))}(t),t.innerHTML}(e.reduce((function(e,t){return e.replace(t.match,(function(e){var n=document.createElement("span");return m(n,e,t),n.outerHTML}))}),t))}}(u):E,A=t.useRef(r({},o,{getInitialHTML:y,setPositionFixed:function(e){M({fixed:e})},setInputElement:function(e){M({inputElement:e})},selectItem:function(e){var t=A.current.opened;null!=t&&t.element&&m(t.element,e.ref,t.config),M({index:0,results:[],opened:null,loading:!1,activeSearch:""})},onBeforeChanges:function(e){var t=document.getSelection();t&&t.anchorNode&&(!d(t,e)||(t=document.getSelection())&&t.anchorNode)&&(function(e,t){if(!e.defaultPrevented)for(var n=e.data,r=e.currentTarget,i=0;i<t.rangeCount;i++){var o=t.getRangeAt(i);if(o.startContainer===o.endContainer){var a=c(o.startContainer);if(!r.contains(a))continue;if(o.startContainer instanceof Text&&0===o.startOffset){var u=o.startContainer.previousSibling,l=o.startContainer.previousElementSibling;if(u&&l&&u===l&&l.hasAttribute("data-rich-mentions")&&!l.hasAttribute("data-integrity")){l.appendChild(document.createTextNode(n)),e.preventDefault();continue}}if(!a||r===a||!a.hasAttribute("data-rich-mentions"))continue;if(0===o.endOffset){f(a,n,"before"),e.preventDefault();continue}if(a.hasAttribute("data-integrity")&&o.startOffset===(a.textContent||"").length){f(a,n,"after"),e.preventDefault();continue}}}}(e,t),function(e,t){if(!e.defaultPrevented)for(var n=e.currentTarget,r=0;r<t.rangeCount;r++){var i=t.getRangeAt(r);x(i.startContainer,n),x(i.endContainer,n)}}(e,t),function(e,t,n){var r=t.anchorNode;if(!e.defaultPrevented&&r){var i=l(r);if(i){var o=e.data,a=i.textContent+o;n.some((function(e){var t=a.match(e.query);return t&&t[0]===t.input}))||(e.preventDefault(),f(i,o))}}}(e,t,u),function(e,t,n,r){var i=t.anchorNode,o=t.anchorOffset;if(!e.defaultPrevented&&i&&!l(i)){var a=e.data,u=i.textContent||"",c=u.substr(0,o)+a+u.substr(o),f=n.find((function(e){return c.match(e.query)}));if(f){var d=c.match(f.query),m=d.index||0,h=c.substr(0,m);if(!(h.length&&!/\W$/.test(h)||o<m||o>=m+d[0].length)){i.textContent=h;var p=document.createElement("span"),g=d[0].substr(0,o-m+a.length),v=c.substr(m+g.length);p.setAttribute("data-rich-mentions",""),p.setAttribute("spellcheck","false"),p.textContent=g,f.customizeFragment&&f.customizeFragment(p,!1);var x=document.createTextNode(/^\s/.test(v)?v:" "+v),b=e.currentTarget===i,C=b?i:i.parentElement;C&&(b?(C.appendChild(p),C.appendChild(x)):(C.insertBefore(x,i.nextSibling),C.insertBefore(p,i.nextSibling))),e.preventDefault(),s(p.childNodes[0],o-h.length+1),r.openAutocomplete(p,g,f)}}}}(e,t,u,A.current),h(e.currentTarget,u))},onChanges:function(){var e=A.current,t=e.inputElement,n=e.openAutocomplete,r=e.closeAutocomplete,i=document.getSelection();t&&h(t,u);var o=(null==i?void 0:i.anchorNode)&&l(i.anchorNode);if(o&&!o.hasAttribute("data-integrity")){var a=o.textContent||"",c=u.find((function(e){return a.match(e.query)}));c&&n(o,a,c)}else A.current.opened&&r();C&&C(I())},onKeyDown:function(e){var t=A.current,n=t.results,r=t.index,i=t.selectItem,o=t.closeAutocomplete;if(t.opened&&n.length)switch(e.keyCode){case 40:e.preventDefault(),M({index:Math.min(r+1,n.length-1)});break;case 38:e.preventDefault(),M({index:Math.max(r-1,0)});break;case 9:case 13:n[r]&&(e.preventDefault(),i(n[r]));break;case 27:o()}},closeAutocomplete:function(){M({opened:null,loading:!1,results:[],index:0,activeSearch:""})},openAutocomplete:function(e,t,n){var r=e.getBoundingClientRect(),i={top:0,right:0,bottom:0,left:0};A.current.inputElement&&(i=A.current.inputElement.getBoundingClientRect()),M({loading:!0,index:0,opened:{config:n,fixed:!0,bottom:!0,right:!0,element:e,x:r.right-i.left,y:r.bottom-i.top},activeSearch:t});var o=function(t){var n;void 0===t&&(t=[]),(null==(n=A.current.opened)?void 0:n.element)===e&&M({results:t,loading:!1})},a=n.onMention(t,o);a instanceof Promise?a.then(o,o):a instanceof Array&&o(a)},setActiveItemIndex:function(e){M({index:e})},getTransformedValue:I,insertFragment:function(e,t){void 0===t&&(t=null),function(e,t,n,r){var i=n.find((function(t){return e.match(t.match)}));if(r&&(i||t)){var o=null,a=null,u=!1,c=!1,f=document.getSelection();if(f&&f.anchorNode&&r.contains(f.anchorNode)){var x=f.anchorNode,b=f.anchorOffset,C=l(x);if(d(f),C&&b===(x.textContent||"").length&&(C.nextSibling||r.insertBefore(document.createTextNode(""),null),x=C.nextSibling,b=0,C=null),C)if(C.hasAttribute("data-integrity")){var E;a=C.nextSibling,null==(E=C.parentElement)||E.removeChild(C)}else{var y=x.textContent||"";if(b>0&&b<y.length){var A=y.substr(0,b),T=y.substr(b),N=document.createTextNode(T);r.insertBefore(N,C.nextSibling),x.textContent=A,u=!0,a=N}u=g(y,b,x,u),c=v(y,b,x)}else{var S=x.textContent||"";if(b>0)o=x;else{var M=x;!S&&"DIV"===M.nodeName&&!M.attributes.length&&1===M.childNodes.length&&M.firstElementChild instanceof HTMLBRElement?M.previousSibling instanceof HTMLDivElement?(a=x,M.removeChild(M.firstElementChild)):(o=x,M.removeChild(M.firstElementChild)):a=x}if(b>0&&b<S.length){var B,I=S.substr(0,b),R=S.substr(b);S=I,x.textContent=I,null==(B=x.parentElement)||B.insertBefore(document.createTextNode(R),x.nextSibling)}u=g(S,b,x,u),c=v(S,b,x)}}else{var D=r.textContent||"";c=!0,u=!p(D.charAt(D.length-1))}var L,O=document.createElement("span");if(i?m(O,e,i):t&&(O.appendChild(t),O.setAttribute("data-rich-mentions",e),O.setAttribute("data-integrity",O.innerHTML),O.setAttribute("spellcheck","false")),o&&o!==r)null==(L=o.parentElement)||L.insertBefore(O,o.nextSibling);else if(a&&a!==r){var _;null==(_=a.parentElement)||_.insertBefore(O,a)}else r.appendChild(O);if(u){var H,j=document.createTextNode(" ");null==(H=O.parentElement)||H.insertBefore(j,O)}if(c){var w,V=document.createTextNode(" ");null==(w=O.parentElement)||w.insertBefore(V,O.nextSibling)}O.nextSibling&&s(O.nextSibling,c?1:0),h(r,n)}}(e,t,u,A.current.inputElement)},setValue:function(e){var t=A.current,n=t.inputElement,r=t.closeAutocomplete;n&&(n.innerHTML=y(e),h(n,u)),r()}})),T=t.useState(A.current),N=T[0],S=T[1],M=function(e){A.current=r({},A.current,e),S(A.current)};function B(){var e=A.current,t=e.inputElement,n=e.opened,r=e.closeAutocomplete,i=e.openAutocomplete,o=e.getTransformedValue,a=document.getSelection(),c=(null==a?void 0:a.anchorNode)&&(l(a.anchorNode)||0===a.anchorOffset&&a.anchorNode.previousSibling&&l(a.anchorNode.previousSibling)),s=c&&!c.hasAttribute("data-integrity")&&t&&t.contains(c);if(n&&!s)r();else if(s&&c&&(!n||n.element!==c)){var f=c.textContent||"",d=u.find((function(e){return f.match(e.query)}));d&&i(c,f,d)}C&&C(o())}function I(){return function(e){if(!e||"<br>"===e.innerHTML)return"";var t="_br_"+Date.now()+"_",n=new RegExp("\\n?"+t+"\\n?","g");return Array.from(e.childNodes).map((function(e){return function e(t,n){if(t instanceof Text)return t.textContent||"";if(t instanceof HTMLBRElement)return n;if(t instanceof Element){var r=t.getAttribute("data-rich-mentions");if(r)return r;var i=t instanceof HTMLDivElement?"\n":"";return""+i+Array.from(t.childNodes).map((function(t){return e(t,n)})).join("")+i}return""}(e,t)})).join("").replace(/\u00A0/g," ").replace(/\n{2,}/g,"\n").replace(n,"\n").trim()}(A.current.inputElement)}return t.useEffect((function(){return document.addEventListener("selectionchange",B,!1),function(){document.removeEventListener("selectionchange",B,!1)}})),t.useEffect((function(){"function"==typeof b?b(N):"object"==typeof b&&(b.current=N)}),[b,N]),n.createElement(a.Provider,{value:N},i)},exports.initialContext=o;
//# sourceMappingURL=react-rich-mentions.cjs.production.min.js.map
